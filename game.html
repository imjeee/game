<!DOCTYPE html>
<html>
<head>
  <style>
  </style>
</head>
<body>
<script>

  const cc = console.log

  const loadImage = url => {
    return new Promise((resolve, reject) => {
      const img = new Image()
      img.onload = () => resolve(img)
      img.onerror = () => reject()
      img.src = url
    })
  }

  // create background canvas
  const bgCanvas = document.createElement('canvas')
  const bgCtx = bgCanvas.getContext('2d')
  bgCanvas.width = 1920
  bgCanvas.height = 1200
  bgCanvas.style.position = 'absolute'
  bgCanvas.style.top = 0
  bgCanvas.style.left = 0
  document.body.appendChild(bgCanvas)

  // create foreground canvas
  const fgCanvas = document.createElement('canvas')
  const fgCtx = fgCanvas.getContext('2d')
  fgCanvas.width = 1920
  fgCanvas.height = 1200
  fgCanvas.style.position = 'absolute'
  fgCanvas.style.top = 0
  fgCanvas.style.left = 0
  document.body.appendChild(fgCanvas)

  // background image
  let backgroundImage;
  loadImage('img/background.png')
  .then(bgImg => {
    backgroundImage = bgImg
    // bgCtx.drawImage(backgroundImage, 0, 0)
  })

  let heroImage;
  loadImage('img/hero.png')
  .then(hrImg => {
    heroImage = hrImg;
    // cc('h2')
    // fgCtx.drawImage(heroImage, hero.x, hero.y);
  })

  // game objects
  let hero = {
    topSpeed: 100, // movement in pixels per second
    jumpSpeed: 0,

    x: 0,
    vx: 2,
    ax: .5,

    y: 722,
    vy: 2,
    ay: .5
    
  }

  // handle keyboard controls
  var keysDown = {}

  window.addEventListener('keydown', (e) => {
    keysDown[e.keyCode] = true
  }, false)

  window.addEventListener('keyup', (e) => {
    delete keysDown[e.keyCode]
  }, false)

  //update game object
  const update = (modifier) => {



    if (37 in keysDown) { // Player holding left
      if (Math.abs(hero.vx) < hero.topSpeed) {
        hero.vx -= hero.ax
      }
    }

    if (39 in keysDown) { // Player holding right
      if (Math.abs(hero.vx) < hero.topSpeed) {
        hero.vx += hero.ax
      }
    }

    if (Object.keys(keysDown).length === 0) {
      hero.vx /= 1.2;
      if (Math.abs(hero.vx) < 1) {
        hero.vx = 0
      }
    }

    hero.x += hero.vx
    hero.x = Math.max(hero.x, 0)
    hero.x = Math.min(hero.x, fgCanvas.width - 150)
  }

  const render = function() {
    if (backgroundImage) {
      bgCtx.drawImage(backgroundImage, 0, 0)
    }

    if (heroImage) {
      fgCtx.clearRect(hero.x - 100, hero.y - 100, 250, 300)
      fgCtx.drawImage(heroImage, hero.x, hero.y, 150, 200)
    }
  }

  let main = function() {
    // console.log(hero.x)
    update(10)
    render(10)
    requestAnimationFrame(main)
  }

  main()

</script>
</body>
</html>